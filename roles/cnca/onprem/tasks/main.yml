# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2019-2020 Intel Corporation

---
- name: offline | set _gopath
  set_fact:
    _gopath: "{{ _offline_path }}/golang_modules/cnca"
  when: _offline_mode

- name: build CNCA plugin
  shell: source /etc/profile && GOPATH="{{ _gopath }}" go build -ldflags "-X cnca.HTTP2ClientTLSCAPath={{ _certs_dest }}/ngc" -o "{{ _cnca_plugin_name }}"
  args:
    chdir: "{{ _epcforedge_git_repo.download_dir }}/cnca/"
  changed_when: true

- name: install CNCA plugin
  command: mv "{{ _cnca_plugin_name }}" "{{ _cnca_plugin_dest }}"
  args:
    chdir: "{{ _epcforedge_git_repo.download_dir }}/cnca/"
  changed_when: true

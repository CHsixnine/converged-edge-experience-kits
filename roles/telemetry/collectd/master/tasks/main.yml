# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2020 Intel Corporation

---

- name: check if collectd already exists
  command: helm status collectd
  ignore_errors: yes
  changed_when: False
  register: get_collectd

- name: copy Helm chart to Controller node
  block:
  - name: copy Helm chart to the master node
    copy:
      src: "{{ role_path }}/charts/"
      dest: "{{ _collectd_chart_dir }}"

- name: install collectd using Helm
  command: "helm install collectd --namespace telemetry {{ _collectd_chart_dir }}"
  changed_when: true
  when: get_collectd.rc != 0

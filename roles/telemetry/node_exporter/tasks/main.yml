# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2020 Intel Corporation

---

- name: create temporary directory
  tempfile:
    state: directory
    suffix: node-exporter
  register: tmp_dir
  delegate_to: localhost

- name: copy config_map.yml to tmp directory
  copy:
    src: "config_map.yml"
    dest: "{{ tmp_dir.path }}/"

- name: deploy Node Exporter config map
  command: kubectl apply -f "{{ tmp_dir.path }}"/config_map.yml
  changed_when: true

- name: copy daemonset.yml to tmp directory
  copy:
    src: "daemonset.yml"
    dest: "{{ tmp_dir.path }}/"

- name: deploy Node Exporter
  command: kubectl apply -f "{{ tmp_dir.path }}"/daemonset.yml
  changed_when: true

- name: remove temporary directory
  file:
    path: "{{ tmp_dir.path }}"
    state: absent
  when: tmp_dir.path is defined

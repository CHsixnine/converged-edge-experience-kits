# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2020 Intel Corporation

---

- name: cleanup docker-registry
  command: "{{ item }}"
  with_items:
    - kubectl -n openness delete  deployment docker-registry-deployment
    - kubectl get pods -n openness --no-headers=true | awk '/docker-registry/{print $1}'| xargs  kubectl delete -n openness pod --grace-period=0 --force
    - docker rmi -f  registry:"{{ _registry_version }}"
  changed_when: true
  ignore_errors: yes

- name: delete certificate from master node
  file:
    path: "/etc/docker/certs.d/{{ _registry_ip_address }}:{{ _registry_port }}"
    state: absent
  ignore_errors: yes

- name: delete docker-registry file
  file:
    path: "{{ _registry_location }}"
    state: absent
  ignore_errors: yes

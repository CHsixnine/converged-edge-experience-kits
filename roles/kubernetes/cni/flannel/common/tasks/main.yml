# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2020 Intel Corporation

---
#TODO: Remove firewall changes once https://github.com/coreos/flannel/issues/1033 is fixed and released
- name: "[WORKAROUND] add firewall rule for flannel(Source)"
  command: firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 10 -s {{ flannel_cidr }} -j ACCEPT
  ignore_errors: yes
  changed_when: true

- name: "[WORKAROUND] add firewall rule for flannel(Destination)"
  command: firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 10 -d {{ flannel_cidr }} -j ACCEPT
  ignore_errors: yes
  changed_when: true

- name: "[WORKAROUND] reload firewall rules"
  command: firewall-cmd --reload
  changed_when: false
  ignore_errors: yes

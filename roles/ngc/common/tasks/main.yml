# SPDX-License-Identifier: Apache-2.0
# Copyright Â© 2019 Intel Corporation

---

- name: make sure /etc/openness, /etc/openness/certs and /etc/openness/configs exist
  file:
    path: "{{ item }}"
    state: directory
  with_items:
  - /etc/openness
  - "{{ certs_dest }}"
  - "{{ configs_dest }}"

- name: create temporary custom .openness_gitconfig
  include_tasks: ../../../git_repo/tasks/gitconfig_bootstrap.yml
  
- block:
  - name: checkout clean epcforedge repository
    git:
      repo: "{{ epcforedge_git_repo.dir }}"
      dest: "{{ epcforedge_git_repo.download_dir }}"
      version: "{{ epcforedge_git_repo.branch }}"
      force: yes
    always:
    - name: remove .openness_gitconfig
      include_tasks: ../../../git_repo/tasks/gitconfig_remove.yml

- name: make sure repository exists
  git:                                                                                                                                
    repo: "{{ epcforedge_git_repo.dir }}"
    dest: "{{ epcforedge_git_repo.download_dir }}"
    version: "{{ epcforedge_git_repo.branch }}"                                                                                       
    force: yes                                                                                          
    update: no

- name: create directory for certs used by AF and NEF
  file:
    name: "{{ certs_dest }}/ngc"
    state: directory

- name: create directory for ngc configs
  file:
    name: "{{ configs_dir }}/ngc"
    state: directory

- name: copy genCerts.json file
  copy:
    src: "{{ git_repo_ngc_dir }}/scripts/genCerts.sh"
    dest: "{{ certs_dest }}/ngc"

